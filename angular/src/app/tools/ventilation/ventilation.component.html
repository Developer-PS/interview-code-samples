<div class="ventilation-container">
  <div class="header">
    <h1>Lüftungsassistent</h1>
    <p>Berechnet anhand der absoluten Luftfeuchtigkeit, ob es sich zu lüften lohnt.</p>
  </div>

  <form [formGroup]="ventilationForm">
    <div class="form-sections-container">
      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Werte innen</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-form-field>
            <mat-label>Innentemperatur (°C)</mat-label>
            <input matInput type="number" formControlName="indoorTemperature" required>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Luftfeuchtigkeit innen (%)</mat-label>
            <input matInput type="number" formControlName="indoorHumidity" required>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card appearance="outlined">
        <mat-card-header>
          <mat-card-title>Werte außen</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="location-mode-toggle">
            <mat-slide-toggle [checked]="useCurrentLocation" (change)="toggleLocationMode()">
              Werte aus aktuellem Standort übernehmen
            </mat-slide-toggle>
          </div>

          <div *ngIf="!useCurrentLocation" class="form-field">
            <mat-form-field>
              <mat-label>Ort eingeben</mat-label>
              <input matInput formControlName="location" placeholder="z.B. Berlin, Deutschland">
            </mat-form-field>
          </div>

          <div class="action-container">
            <button *ngIf="!loading" mat-stroked-button (click)="updateWeatherData()">Wetterdaten abrufen</button>
            <mat-spinner *ngIf="loading" diameter="30"></mat-spinner>
          </div>

          <div class="weather-data">
            <div class="form-field">
              <mat-form-field>
                <mat-label>Außentemperatur (°C)</mat-label>
                <input matInput type="number" formControlName="outdoorTemperature" required>
              </mat-form-field>
            </div>

            <div class="form-field">
              <mat-form-field>
                <mat-label>Luftfeuchtigkeit außen (%)</mat-label>
                <input matInput type="number" formControlName="outdoorHumidity" required>
              </mat-form-field>
            </div>

            <div *ngIf="lastUpdated && location" class="last-updated">
              Werte für {{ location }} zuletzt am {{ formatDate(lastUpdated) }} übernommen
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="button-row">
      <button mat-flat-button (click)="calculateVentilation()" [disabled]="ventilationForm.invalid">
        Berechnen
      </button>
    </div>
  </form>

  <div *ngIf="displayResult" class="result-container">
    <mat-card appearance="outlined">
      <mat-card-header>
        <mat-card-title class="result-text" [ngClass]="{'yes': result === 'JA', 'no': result === 'NEIN'}">Lüften: {{ result }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p *ngIf="result === 'JA'" class="result-description">Die absolute Luftfeuchtigkeit innen ({{ formatHumidity(indoorAbsoluteHumidity) }}
          g/m³) ist höher als außen ({{ formatHumidity(outdoorAbsoluteHumidity) }} g/m³). Es lohnt sich zu lüften, da
          die feuchte Luft nach draußen abgeführt werden kann.
        </p>
        <p  *ngIf="result === 'NEIN'" class="result-description">Die absolute Luftfeuchtigkeit innen ({{ formatHumidity(indoorAbsoluteHumidity) }}
          g/m³) ist niedriger oder gleich der Außenluft ({{ formatHumidity(outdoorAbsoluteHumidity) }} g/m³). Lüften
          würde die Feuchtigkeit im Raum erhöhen.
        </p>

        <div class="indoor">
          <span class="label">Absolute Luftfeuchtigkeit innen:</span>
          <span class="value">{{ formatHumidity(indoorAbsoluteHumidity) }} g/m³</span>
        </div>
        <div class="outdoor">
          <span class="label">Absolute Luftfeuchtigkeit außen:</span>
          <span class="value">{{ formatHumidity(outdoorAbsoluteHumidity) }} g/m³</span>
        </div>
        <div class="difference"
             [ngClass]="{'positive': indoorAbsoluteHumidity > outdoorAbsoluteHumidity, 'negative': indoorAbsoluteHumidity <= outdoorAbsoluteHumidity}">
          <span class="label">Differenz:</span>
          <span class="value">{{ formatHumidity(indoorAbsoluteHumidity - outdoorAbsoluteHumidity) }} g/m³</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
